---
title: "iBET - interactive Bioinformatics Exploratory Tools"
author: 
- name: "Jared Andrews"
  email: jared.andrews@stjude.org
  affiliation: St. Jude Children's Research Hospital, Memphis, TN
date: "September 20th, 2021"
output: 
  html_document:
    code_folding: hide
    toc: true
    toc_depth: 5
    toc_float: true	 
runtime: shiny
vignette: >
  %\VignetteIndexEntry{iBET - Interactive Shiny Widgets for Bioinformatics Packages}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{css, echo=FALSE}
# This is to change width of the content so that half the page isn't empty as it is by default.
body {
  max-width: 1850px !important;
}
div.main-container {
  max-width: 1850px !important;
  width: 1850px !important;
  margin-left: auto !important;
  margin-right: auto !important;
}
.toc-content {
  padding-right: 0px;
  padding-left: 0px;
  margin-left: 300px;
  max-width: 1550px !important;
  width: 1550px !important;
}
```

```{r, include=FALSE}
library(BiocStyle)
knitr::opts_chunk$set(echo = TRUE, fig.align = "center", message = FALSE, warning = FALSE)
```

# Introduction

Generating static reports from R markdown documents is a common way to distribute bioinformatics analyses with additional context and commentary. However, interactivity within these reports is limited. While one can embed minimally interactive figures in HTML reports, there is no way to alter the underlying data or plot by the end user.

[Shiny](https://shiny.rstudio.com/) provides an avenue to overcome this limitation, as [Shiny widgets](https://bookdown.org/yihui/rmarkdown/shiny-widgets.html) can be designed to interactively perform or display the results of an analysis. This comes with the downside that the Rmd file and necessary code must be hosted on a server that can run Shiny applications and interactive documents. [Options](https://www.rstudio.com/products/shiny/shiny-server/) include RStudio Connect, [shiny.apps.io](shiny.apps.io) (which has a free tier), and Shiny Server.

[iBET](https://github.com/j-andrews7/iBET) (interactive Bioinformatics Exploratory Tools) is an R package that contains drop-in Shiny widgets that run and/or display the results of common analyses performed with bioinformatics R packages. These empower end-users to fully immerse themselves in the data through interactive alterations of plot and analysis parameters. Hopefully, it helps to alleviate some of the frustration that comes with frequent back-and-forth interactions to generate and alter figures. While these widgets are designed for drop-in use in Rmd notebooks, they also functions perfectly well as Shiny apps on their own when run from the console.

# The Widgets

First, let's load up some example data.

```{r, message = FALSE, warning = FALSE}
shh <- suppressPackageStartupMessages
shh(library("msigdbr"))

# Retrieve MSigDB Hallmark gene sets and convert to a named list.
hs.msig <- msigdbr(species = "Homo sapiens", category = "H")
hs.msig <- hs.msig %>% split(x = .$gene_symbol, f = .$gs_name)
```

## MAGeCK CRISPR Screen Exploration

This widget allows for interactive exploration of CRISPR screen data as analyzed by the MAGeCK RRA method.

```{r}
crispr.data <- readRDS("Z:/ResearchHome/ClusterHome/jandrews/Projects/JR.LTC77_99.VakocTF_CRISPR.01272022/CRISPRviz/data/CRISPR_data.RDS")

hs.msig <- readRDS("Z:/ResearchHome/ClusterHome/jandrews/Projects/JR.LTC77_99.VakocTF_CRISPR.01272022/CRISPRviz/data/hs.misg.all.RDS")
#depmap.data <- readRDS("Z:/ResearchHome/ClusterHome/jandrews/Projects/JR.LTC77_99.VakocTF_CRISPR.01272022/CRISPRviz/data/DepMap_data.RDS")
```

```{r}
depmap.gene <- depmap::depmap_gene_summary()
hs.msig[["DepMap_CRISPR_Essential"]] <- depmap.gene$gene_name[depmap.gene$dataset == "Chronos_Combined" & depmap.gene$common_essential == "True"]
hs.msig[["DepMap_CRISPR_Selective"]] <- depmap.gene$gene_name[depmap.gene$dataset == "Chronos_Combined" & depmap.gene$strongly_selective == "True"] 
hs.msig[["DepMap_RNAi_Essential"]] <- depmap.gene$gene_name[depmap.gene$dataset == "RNAi_merged" & depmap.gene$common_essential == "True"] 
hs.msig[["DepMap_RNAi_Selective"]] <- depmap.gene$gene_name[depmap.gene$dataset == "RNAi_merged" & depmap.gene$strongly_selective == "True"] 

CRISPRball(gene.data = crispr.data$genes, sgrna.data = crispr.data$sgrnas, count.summary = crispr.data$counts$ct_summary, 
           norm.counts = crispr.data$counts$norm_counts, positive.ctrl.genes = c("PCNA", "CDK1", "RPL9", "CDK9", "POLR2D", "RPL23A", "POLR2A", "RPA3"), 
           depmap.db = "depmap_db.sqlite", genesets = hs.msig)
```

# SessionInfo

<details>

<summary>Click to expand</summary>

```{r, echo = FALSE}
sessionInfo()
```

</details>
